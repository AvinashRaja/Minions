<!DOCTYPE html>
<html>
    <head>
        <title></title>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
        <script src='lib/quintus.js'></script>
        <script src='lib/quintus_sprites.js'></script>
        <script src='lib/quintus_scenes.js'></script>
        <script src='lib/quintus_input.js'></script>
        <script src='lib/quintus_anim.js'></script>
        <script src='lib/quintus_2d.js'></script>
        <script src='lib/quintus_touch.js'></script>
        <script src='lib/quintus_ui.js'></script>
    </head>
    <body style="background-color: black;">
        <script>

        var Q = window.Q = Quintus()
            .include("Sprites, Scenes, Input, 2D, Anim, Touch, UI")
            .setup({ maximize: true })
            .controls().touch();
        
        Q.scene("gameStats", function (stage) {
            var statsContainer = stage.insert(new Q.UI.Container({
                fill: "gray",
                x: 960 / 2,
                y: 620,
                border: 1,
                shadow: 3,
                shadowColor: "rgba(0,0,0,0.5)",
                w: 960,
                h: 40
            })
            );

            var lives = stage.insert(new Q.UI.Text({
                label: "Lives x 3",
                color: "white",
                x: -300,
                y: 0
            }), statsContainer);

            var coins = stage.insert(new Q.UI.Text({
                label: "Coins x 0",
                color: "white",
                x: 300,
                y: 0
            }), statsContainer);
        });

        Q.Sprite.extend("Coin", {
            init: function (p) {
                this._super(p, { asset: "coin.png" });
            }
        });

        var SPRITE_BOX = 1;

        Q.gravityY = 2000;

        Q.Sprite.extend("Player", {
            init: function (p) {
                this._super(p, {
                    sheet: "player",        // Spritesheet
                    sprite: "player",       // Animationsheet
                    x: 40,
                    y: 400,                
                    jump: -850,
                    speed: 500,
                    scale: 0.4,             // scale sprite to right size
                    flip: "",
                    collisionMask: SPRITE_BOX,
                });

                //this.p.points = [[0, 0], [20, 0], [20, 20], [0, 20]]; //Giving player points of collision

                this.add("2d, animation");  // Add components
            },
            step: function (dt) {
                this.p.vx += (this.p.speed - this.p.vx) / 4;

                if (this.p.y > 595) {
                    this.p.y = 595;
                    this.p.landed = 1;
                    this.p.vy = 0;
                } else {
                    this.p.landed = 0;
                }

                if (Q.inputs['up'] && this.p.landed > 0) {
                    this.p.vy = this.p.jump;
                }

                if (this.p.landed) {
                        this.play("walk_right");
                } else {
                    this.play("jump");
                }

                this.stage.viewport.centerOn(this.p.x + 350, 400);
            }

        });

        Q.scene("level1", function (stage) {
            stage.insert(new Q.Repeater({ asset: "background-sky.png", speedX: 0.04 }));
            stage.insert(new Q.Repeater({ asset: "background-mount.png", repeatY: false, speedX: 0.2, y: 190 }));
            stage.insert(new Q.Repeater({ asset: "background-floor.png", repeatY: false, speedX: 0.4, y: 320, type: SPRITE_BOX }));

            //stage.insert(new Q.BoxThrower());

            stage.insert(new Q.Player());
            stage.add("viewport");//.follow(player, { x: true, y: true }, { minX: 0, maxX: background.p.w, minY: 0, maxY: background.p.h });
        });

        Q.load("player.png, background-sky.png, background-mount.png, background-floor.png, coin.png", function () {
            Q.sheet("player", "player.png", { "tilew": 130, "tileh": 230, "sx": 0, "sy": 0 });
            Q.animations("player", {
                walk_left: { frames: [0, 1, 2, 3], next: 'stand_left', rate: 1 / 5 },
                walk_right: { frames: [0, 1, 2, 3], next: 'stand_right', rate: 1 / 5 },
                stand_left: { frames: [0] },
                stand_right: { frames: [0] },
                jump: { frames: [2], loop: false, rate: 1 },
            });
            Q.stageScene("level1");
        });                 
        
        </script>
    </body>
</html>
